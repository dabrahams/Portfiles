# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id: Portfile 95119 2012-07-05 21:01:06Z mww@macports.org $

PortSystem          1.0

name                isync
revision        1
categories          mail
platforms           darwin
license             GPL-2
maintainers         nomaintainer
description         Synchronize a maildir with an imap server
homepage            http://isync.sourceforge.net/

long_description    isync is a command line utility for synchronizing a \
                    remote IMAP mailbox with a local maildir-style mailbox. \
                    This is useful for working in disconnected mode, such as \
                    on a laptop. Modifications made locally and remotely are \
                    synchronized so that no message status flags are lost.

if {${subport} == ${name}} {

    version             1.0.5
    master_sites        sourceforge
    conflicts           isync-devel
    checksums           md5     6a47b0b620ef61d4158e4f1b968ffb0f \
        sha1    9d19cde13b644d6e394f06d292b60503396d0500 \
        rmd160  180607a0633108ad59ea5a51d15b1f3c74b56a9a

    post-patch {
        reinplace "s|ldb|ldb-5.3|g" \
            ${worksrcpath}/src/compat/Makefile.in \
            ${worksrcpath}/src/Makefile.in
        reinplace -E "s|\\<perl\\>|/opt/local/bin/perl5.12|g" \
            ${worksrcpath}/Makefile.in
    }

}

subport isync-devel {

    version             git-master-20121016
    fetch.type          git
    git.url             git://isync.git.sourceforge.net/gitroot/isync/isync
    git.branch          45b11c63a503dd53674ead6f8617af61e7563b78
    conflicts           isync
    livecheck.type      none

    pre-configure {
        system "cd ${worksrcpath} && touch ChangeLog && ./autogen.sh"
    }
}

depends_lib         port:db53 port:openssl port:zlib 
depends_build       port:p5.12-timedate

post-patch {
    reinplace "s|ldb|ldb-5.3|g" \
        ${worksrcpath}/src/compat/Makefile.am \
        ${worksrcpath}/src/Makefile.am
    reinplace -E "s|\\<perl\\>|/opt/local/bin/perl5.12|g" \
        ${worksrcpath}/Makefile.am
}

configure.args      --mandir=${prefix}/share/man
configure.cppflags-append   -I${prefix}/include/db53
configure.ldflags-append    -L${prefix}/lib/db53
