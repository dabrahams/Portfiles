# $Id: Portfile 89053 2012-01-18 22:37:55Z afb@macports.org $

PortSystem 1.0

name		zeroinstall-injector
version		1.7
platforms	darwin freebsd linux
categories	sysutils
license		LGPL
maintainers	afb
description	The Zero Install Injector (0launch)
long_description \
The Zero Install Injector makes it easy for users to install software without \
needing root privileges. It takes the URL of a program and runs it (downloading \
it first if necessary). Any dependencies of the program are fetched in the same \
way. The user controls which version of the program and its dependencies to \
use.

homepage	http://0install.net
master_sites	sourceforge
master_sites.mirror_subdir	project/zero-install/injector/1.7
use_bzip2	yes
distfiles       zeroinstall-injector-1.7.tar.bz2

checksums           rmd160  46ac65794f57146afed45582d4ff43f05ffe5bb9 \
                    sha256  4472d5964e14a16cec5a27bbfc169340b7e45781ec2429abeaa4726674987c2c

depends_lib	port:python26 bin:gpg:gnupg
depends_run	port:py26-gtk port:py26-xml bin:sudo:sudo

post-patch   {
	reinplace "s|'man/man1'|'share/man/man1'|" ${worksrcpath}/setup.py
}

use_configure	no
supported_archs	noarch

build.cmd	${prefix}/bin/python2.6 setup.py
build.target		build

destroot.cmd	${prefix}/bin/python2.6 setup.py
destroot.destdir	--prefix=${prefix} --skip-build --root=${destroot}

post-destroot   {
	reinplace "s|/usr/bin/env python|${prefix}/bin/python2.6|" \
	          ${destroot}${prefix}/lib/python2.6/site-packages/zeroinstall/0launch-gui/0launch-gui

	# move site-packages to wherever python is looking for it
	file mkdir ${destroot}[exec ${prefix}/bin/python2.6 -c "from distutils.sysconfig import get_python_lib; import os; print os.path.dirname(get_python_lib())"]
	file rename ${destroot}${prefix}/lib/python2.6/site-packages \
	            ${destroot}[exec ${prefix}/bin/python2.6 -c "from distutils.sysconfig import get_python_lib; print get_python_lib()"]
}

livecheck.name	zero-install
livecheck.distname	injector
